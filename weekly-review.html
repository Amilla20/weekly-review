<!DOCTYPE html>
<html>
<head>
    <title>–£–º–Ω—ã–π –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.export {
            background-color: #27ae60;
        }
        button.import {
            background-color: #f39c12;
        }
        button.reminder {
            background-color: #9b59b6;
        }
        .review-item {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .saved-reviews {
            margin-top: 30px;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 5px;
            display: none;
            z-index: 1000;
        }
        .archive-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</div>
    
    <h1>üìÖ –£–º–Ω—ã–π –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä</h1>
    
    <div class="controls">
        <div>
            <label for="week">–ù–µ–¥–µ–ª—è:</label>
            <input type="week" id="week" name="week">
        </div>
        <div>
            <button class="reminder" onclick="setFridayReminder()">‚è∞ –ù–∞–ø–æ–º–Ω–∏—Ç—å –≤ –ø—è—Ç–Ω–∏—Ü—É –≤ 14:00</button>
        </div>
    </div>
    
    <div class="review-item">
        <h3>‚úÖ 3 —É—Å–ø–µ—Ö–∞</h3>
        <textarea id="good-things" placeholder="1. ..."></textarea>
    </div>
    
    <div class="review-item">
        <h3>üí™ –°–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
        <textarea id="hard-things"></textarea>
    </div>
    
    <div class="review-item">
        <h3>üöÄ –ü–ª–∞–Ω—ã</h3>
        <textarea id="next-week"></textarea>
    </div>
    
    <div class="controls">
        <button onclick="saveReview()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="export" onclick="exportToExcel()">üìä Excel</button>
        <button class="import" onclick="importData()">üì• –ò–º–ø–æ—Ä—Ç</button>
    </div>
    
    <div class="saved-reviews">
        <div class="archive-controls">
            <h2>üìÅ –ê—Ä—Ö–∏–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –Ω–µ–¥–µ–ª–∏)</h2>
            <button onclick="toggleFullArchive()">–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Å—å –∞—Ä—Ö–∏–≤</button>
        </div>
        <div id="reviews-list"></div>
        <div id="full-archive" class="hidden"></div>
    </div>

    <script>
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        let autosaveTimer;
        function setupAutosave() {
            const fields = ['week', 'good-things', 'hard-things', 'next-week'];
            fields.forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    clearTimeout(autosaveTimer);
                    autosaveTimer = setTimeout(saveReview, 2000);
                });
            });
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        function saveReview() {
            const week = document.getElementById('week').value;
            if (!week) return;
            
            const review = {
                week,
                goodThings: document.getElementById('good-things').value,
                hardThings: document.getElementById('hard-things').value,
                nextWeek: document.getElementById('next-week').value,
                lastModified: new Date().toISOString()
            };
            
            let reviews = JSON.parse(localStorage.getItem('weeklyReviews')) || [];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º
            const existingIndex = reviews.findIndex(r => r.week === week);
            if (existingIndex >= 0) {
                reviews[existingIndex] = review;
            } else {
                reviews.push(review);
            }
            
            localStorage.setItem('weeklyReviews', JSON.stringify(reviews));
            showNotification('–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
            displayReviews();
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
        function exportToExcel() {
            const reviews = JSON.parse(localStorage.getItem('weeklyReviews')) || [];
            if (reviews.length === 0) {
                alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!");
                return;
            }
            
            let csv = "–ù–µ–¥–µ–ª—è,–£—Å–ø–µ—Ö–∏,–°–ª–æ–∂–Ω–æ—Å—Ç–∏,–ü–ª–∞–Ω—ã,–î–∞—Ç–∞\n";
            reviews.forEach(review => {
                csv += `"${review.week}","${review.goodThings.replace(/"/g, '""')}",` +
                       `"${review.hardThings.replace(/"/g, '""')}","${review.nextWeek.replace(/"/g, '""')}",` +
                       `"${new Date(review.lastModified).toLocaleString()}"\n`;
            });
            
            const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `—Ä–∞–∑–±–æ—Ä_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }
        
        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        let reviews = [];
                        if (file.name.endsWith('.json')) {
                            reviews = JSON.parse(event.target.result);
                        } else {
                            // –ü–∞—Ä—Å–∏–º CSV
                            const csv = event.target.result;
                            const lines = csv.split('\n');
                            const headers = lines[0].split(',');
                            
                            for (let i = 1; i < lines.length; i++) {
                                if (!lines[i]) continue;
                                const values = lines[i].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);
                                
                                reviews.push({
                                    week: values[0].replace(/"/g, ''),
                                    goodThings: values[1].replace(/"/g, ''),
                                    hardThings: values[2].replace(/"/g, ''),
                                    nextWeek: values[3].replace(/"/g, ''),
                                    lastModified: values[4] ? new Date(values[4].replace(/"/g, '')).toISOString() : new Date().toISOString()
                                });
                            }
                        }
                        
                        const currentReviews = JSON.parse(localStorage.getItem('weeklyReviews')) || [];
                        const mergedReviews = [...currentReviews, ...reviews.filter(r => 
                            !currentReviews.some(cr => cr.week === r.week)
                        )];
                        
                        localStorage.setItem('weeklyReviews', JSON.stringify(mergedReviews));
                        displayReviews();
                        showNotification(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${reviews.length} –∑–∞–ø–∏—Å–µ–π!`);
                    } catch (error) {
                        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ: " + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ –ø—è—Ç–Ω–∏—Ü–∞–º –≤ 14:00
        function setFridayReminder() {
            if (!("Notification" in window)) {
                alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");
                return;
            }
            
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    const now = new Date();
                    let nextFriday = new Date();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –ø—è—Ç–Ω–∏—Ü—É 14:00
                    nextFriday.setDate(now.getDate() + (5 + 7 - now.getDay()) % 7);
                    nextFriday.setHours(14, 0, 0, 0);
                    
                    // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø—è—Ç–Ω–∏—Ü–∞ –∏ –≤—Ä–µ–º—è —É–∂–µ –ø—Ä–æ—à–ª–æ - —Å—Ç–∞–≤–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é
                    if (now.getDay() === 5 && now.getHours() >= 14) {
                        nextFriday.setDate(nextFriday.getDate() + 7);
                    }
                    
                    const timeUntilFriday = nextFriday - now;
                    
                    if (timeUntilFriday > 0) {
                        setTimeout(() => {
                            new Notification("‚è∞ –ü—è—Ç–Ω–∏—á–Ω—ã–π —Ä–∞–∑–±–æ—Ä!", {
                                body: "–ü–æ—Ä–∞ –ø–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏ –Ω–µ–¥–µ–ª–∏! –°–µ–≥–æ–¥–Ω—è –≤ 14:00",
                                icon: "https://img.icons8.com/fluency/48/calendar--v1.png"
                            });
                            
                            // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
                            setInterval(() => {
                                new Notification("‚è∞ –ü—è—Ç–Ω–∏—á–Ω—ã–π —Ä–∞–∑–±–æ—Ä!", {
                                    body: "–ü–æ—Ä–∞ –ø–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏ –Ω–µ–¥–µ–ª–∏! –°–µ–≥–æ–¥–Ω—è –≤ 14:00",
                                    icon: "https://img.icons8.com/fluency/48/calendar--v1.png"
                                });
                            }, 7 * 24 * 60 * 60 * 1000);
                            
                        }, timeUntilFriday);
                        
                        alert(`–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ ${nextFriday.toLocaleString()}`);
                    } else {
                        alert("–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏!");
                    }
                }
            });
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–ª–Ω—ã–º –∞—Ä—Ö–∏–≤–æ–º –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ 3 –Ω–µ–¥–µ–ª—è–º–∏
        function toggleFullArchive() {
            const fullArchive = document.getElementById('full-archive');
            const reviewsList = document.getElementById('reviews-list');
            const button = document.querySelector('.archive-controls button');
            
            if (fullArchive.classList.contains('hidden')) {
                fullArchive.classList.remove('hidden');
                reviewsList.classList.add('hidden');
                button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –Ω–µ–¥–µ–ª–∏';
                displayFullArchive();
            } else {
                fullArchive.classList.add('hidden');
                reviewsList.classList.remove('hidden');
                button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Å—å –∞—Ä—Ö–∏–≤';
                displayReviews();
            }
        }
        
        // –ü–æ–∫–∞–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3 –Ω–µ–¥–µ–ª—å
        function displayReviews() {
            const reviews = JSON.parse(localStorage.getItem('weeklyReviews')) || [];
            const reviewsList = document.getElementById('reviews-list');
            
            reviewsList.innerHTML = '';
            
            if (reviews.length === 0) {
                reviewsList.innerHTML = '<p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–∞–∑–±–æ—Ä–æ–≤.</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            reviews.sort((a, b) => new Date(b.week) - new Date(a.week));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3
            const recentReviews = reviews.slice(0, 3);
            
            recentReviews.forEach(review => {
                const reviewElement = document.createElement('div');
                reviewElement.className = 'review-item';
                reviewElement.innerHTML = `
                    <h3>${review.week}</h3>
                    <p><strong>‚úÖ –£—Å–ø–µ—Ö–∏:</strong> ${review.goodThings || '‚Äî'}</p>
                    <p><strong>üí™ –°–ª–æ–∂–Ω–æ—Å—Ç–∏:</strong> ${review.hardThings || '‚Äî'}</p>
                    <p><strong>üöÄ –ü–ª–∞–Ω—ã:</strong> ${review.nextWeek || '‚Äî'}</p>
                    <small>–ò–∑–º–µ–Ω–µ–Ω–æ: ${new Date(review.lastModified).toLocaleString()}</small>
                    <button onclick="loadReview('${review.week}')">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    <button onclick="deleteReview('${review.week}')" style="background-color:#e74c3c">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                reviewsList.appendChild(reviewElement);
            });
            
            if (reviews.length > 3) {
                reviewsList.innerHTML += `<p>–ò –µ—â—ë ${reviews.length - 3} –∑–∞–ø–∏—Å–µ–π –≤ –∞—Ä—Ö–∏–≤–µ...</p>`;
            }
        }
        
        // –ü–æ–∫–∞–∑ –ø–æ–ª–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞
        function displayFullArchive() {
            const reviews = JSON.parse(localStorage.getItem('weeklyReviews')) || [];
            const fullArchive = document.getElementById('full-archive');
            
            fullArchive.innerHTML = '';
            
            if (reviews.length === 0) {
                fullArchive.innerHTML = '<p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–∞–∑–±–æ—Ä–æ–≤.</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            reviews.sort((a, b) => new Date(b.week) - new Date(a.week));
            
            reviews.forEach(review => {
                const reviewElement = document.createElement('div');
                reviewElement.className = 'review-item';
                reviewElement.innerHTML = `
                    <h3>${review.week}</h3>
                    <p><strong>‚úÖ –£—Å–ø–µ—Ö–∏:</strong> ${review.goodThings || '‚Äî'}</p>
                    <p><strong>üí™ –°–ª–æ–∂–Ω–æ—Å—Ç–∏:</strong> ${review.hardThings || '‚Äî'}</p>
                    <p><strong>üöÄ –ü–ª–∞–Ω—ã:</strong> ${review.nextWeek || '‚Äî'}</p>
                    <small>–ò–∑–º–µ–Ω–µ–Ω–æ: ${new Date(review.lastModified).toLocaleString()}</small>
                    <button onclick="loadReview('${review.week}')">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    <button onclick="deleteReview('${review.week}')" style="background-color:#e74c3c">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                fullArchive.appendChild(reviewElement);
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞
        function loadReview(week) {
            const reviews = JSON.parse(localStorage.getItem('weeklyReviews')) || [];
            const review = reviews.find(r => r.week === week);
            
            if (review) {
                document.getElementById('week').value = review.week;
                document.getElementById('good-things').value = review.goodThings || '';
                document.getElementById('hard-things').value = review.hardThings || '';
                document.getElementById('next-week').value = review.nextWeek || '';
                window.scrollTo(0, 0);
                showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω —Ä–∞–∑–±–æ—Ä –∑–∞ ${week}`);
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–∑–±–æ—Ä–∞
        function deleteReview(week) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–±–æ—Ä –∑–∞ ${week}?`)) {
                let reviews = JSON.parse(localStorage.getItem('weeklyReviews')) || [];
                reviews = reviews.filter(r => r.week !== week);
                localStorage.setItem('weeklyReviews', JSON.stringify(reviews));
                displayReviews();
                displayFullArchive();
                showNotification("–£–¥–∞–ª–µ–Ω–æ!");
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            setupAutosave();
            displayReviews();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const today = new Date();
            const year = today.getFullYear();
            let weekNumber = getWeekNumber(today);
            weekNumber = weekNumber < 10 ? '0' + weekNumber : weekNumber;
            document.getElementById('week').value = `${year}-W${weekNumber}`;
            
            // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π —Ä–∞–∑–±–æ—Ä
            const lastWeek = localStorage.getItem('lastEditedWeek');
            if (lastWeek) {
                loadReview(lastWeek);
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –Ω–µ–¥–µ–ª–∏
        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            const weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
            return weekNo;
        }
    </script>
</body>
</html>